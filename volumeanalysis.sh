#!/bin/bash

#check if the file exists
if [ ! -f $1 ]; then
  echo "Error: File $1 not found."
  exit 1
fi

#get disk image info
disk_image_info=$(fdisk -x $1)


#get partition info
partition_info=$(echo "$disk_image_info" | grep "$1" | grep -v "Disk" | grep -v "Ignoring")

#display partition info
echo "Seq. # | Starting CHS | Starting LBA | Size(MB) | Type"
c=0
while read -r line; do
  seq=`expr $c + 1`
  chs_address=$(echo $line | awk '{print $8}')
  lba_address=$(echo $line | awk '{print $2}')
  size=$(echo $line | awk '{print $4} * 512/1000000')
  type=$(echo $line | awk '{print $6}')
  c=$seq
echo "$seq | $chs_address | $lba_address | $size | $type"
done <<< "$partition_info"


unpartitioned_image_info=$(mmls -B $1)

#display unpartitioned disk space info
unpartitioned_space_info=$(echo "$unpartitioned_image_info" | grep "Unallocated")
echo "Seq. # | Starting LBA | Size(MB)"
while read -r line; do
  seq=$(echo $line | awk '{print $1}')
  lba_address=$(echo $line | awk '{print $3}')
  size=$(echo $line | awk '{print $6}')
  echo "$seq | $lba_address | $size"
done <<< "$unpartitioned_space_info"


